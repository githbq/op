define(function(require, exports, module) {
    module.exports="<!DOCTYPE html>\r\n<html>\r\n<head>\r\n <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n <title></title>\r\n <script type=\"text/javascript\" src=\"../internal.js\"></script>\r\n <script type=\"text/javascript\" src=\"http://api.map.baidu.com/api?v=1.1&services=true\"></script>\r\n <style type=\"text/css\">\r\n .content{width:530px; height: 350px;margin: 10px auto;}\r\n .content table{width: 100%}\r\n .content table td{vertical-align: middle;}\r\n #city,#address{height:21px;background: #FFF;border:1px solid #d7d7d7; line-height: 21px;}\r\n #city{width:60px}\r\n #address{width:130px}\r\n #is_dynamic_label span{vertical-align:middle;margin: 3px 0px 3px 3px;}\r\n #is_dynamic_label input{vertical-align:middle;margin: 3px 3px 3px 50px;}\r\n </style>\r\n</head>\r\n<body>\r\n<div class=\"content\">\r\n <table>\r\n <tr>\r\n <td><var id=\"lang_city\"></var>:</td>\r\n <td><input id=\"city\" type=\"text\" /></td>\r\n <td><var id=\"lang_address\"></var>:</td>\r\n <td><input id=\"address\" type=\"text\" value=\"\" /></td>\r\n <td><a href=\"javascript:doSearch()\" class=\"button\"><var id=\"lang_search\"></var></a></td>\r\n <td><label id=\"is_dynamic_label\" for=\"is_dynamic\"><input id=\"is_dynamic\" type=\"checkbox\" name=\"is_dynamic\" /><span><var id=\"lang_dynamicmap\"></var></span></label></td>\r\n </tr>\r\n </table>\r\n <div style=\"width:100%;height:340px;margin:5px auto;border:1px solid gray\" id=\"container\"></div>\r\n\r\n</div>\r\n<script type=\"text/javascript\">\r\n var map = new BMap.Map(\"container\"),marker,point,styleStr;\r\n map.enableScrollWheelZoom();\r\n map.enableContinuousZoom();\r\n function doSearch(){\r\n if (!document.getElementById('city').value) {\r\n alert(lang.cityMsg);\r\n return;\r\n }\r\n var search = new BMap.LocalSearch(document.getElementById('city').value, {\r\n onSearchComplete: function (results){\r\n if (results && results.getNumPois()) {\r\n var points = [];\r\n for (var i=0; i<results.getCurrentNumPois(); i++) {\r\n points.push(results.getPoi(i).point);\r\n }\r\n if (points.length > 1) {\r\n map.setViewport(points);\r\n } else {\r\n map.centerAndZoom(points[0], 13);\r\n }\r\n point = map.getCenter();\r\n marker.setPoint(point);\r\n } else {\r\n alert(lang.errorMsg);\r\n }\r\n }\r\n });\r\n search.search(document.getElementById('address').value || document.getElementById('city').value);\r\n }\r\n //获得参数\r\n function getPars(str,par){\r\n var reg = new RegExp(par+\"=((\\\\d+|[.,])*)\",\"g\");\r\n return reg.exec(str)[1];\r\n }\r\n function init(){\r\n var mapNode = editor.selection.getRange().getClosedNode(),\r\n isMapImg = mapNode && /api[.]map[.]baidu[.]com/ig.test(mapNode.getAttribute(\"src\")),\r\n isMapIframe = mapNode && domUtils.hasClass(mapNode, 'ueditor_baidumap');\r\n if(isMapImg || isMapIframe){\r\n var url, centerPos, markerPos;\r\n if(isMapIframe) {\r\n url = decodeURIComponent(mapNode.getAttribute(\"src\"));\r\n $G('is_dynamic').checked = true;\r\n styleStr = mapNode.style.cssText;\r\n } else {\r\n url = mapNode.getAttribute(\"src\");\r\n styleStr = mapNode.style.cssText;\r\n }\r\n\r\n centerPos = getPars(url,\"center\").split(\",\");\r\n markerPos = getPars(url, \"markers\").split(\",\");\r\n point = new BMap.Point(Number(centerPos[0]),Number(centerPos[1]));\r\n marker = new BMap.Marker(new BMap.Point(Number(markerPos[0]), Number(markerPos[1])));\r\n map.addControl(new BMap.NavigationControl());\r\n map.centerAndZoom(point, Number(getPars(url,\"zoom\")));\r\n }else{\r\n point = new BMap.Point(116.404, 39.915); // 创建点坐标\r\n marker = new BMap.Marker(point);\r\n map.addControl(new BMap.NavigationControl());\r\n map.centerAndZoom(point, 10); // 初始化地图,设置中心点坐标和地图级别。\r\n }\r\n marker.enableDragging();\r\n map.addOverlay(marker);\r\n }\r\n init();\r\n document.getElementById('address').onkeydown = function (evt){\r\n evt = evt || event;\r\n if (evt.keyCode == 13) {\r\n doSearch();\r\n }\r\n };\r\n dialog.onok = function (){\r\n var center = map.getCenter();\r\n var zoom = map.zoomLevel;\r\n var size = map.getSize();\r\n var mapWidth = size.width;\r\n var mapHeight = size.height;\r\n var point = marker.getPoint();\r\n\r\n if($G('is_dynamic').checked) {\r\n var URL = editor.options.UEDITOR_HOME_URL,\r\n url = [URL + (/\\/$/.test(URL) ? '':'/') + \"dialogs/map/show.html\" +\r\n '#center=' + center.lng + ',' + center.lat,\r\n '&zoom=' + zoom,\r\n '&width=' + mapWidth,\r\n '&height=' + mapHeight,\r\n '&markers=' + point.lng + ',' + point.lat,\r\n '&markerStyles=' + 'l,A'].join('');\r\n editor.execCommand('inserthtml', '<iframe class=\"ueditor_baidumap\" src=\"' + url + '\"' + (styleStr ? ' style=\"' + styleStr + '\"' :'') + ' frameborder=\"0\" width=\"' + (mapWidth+4) + '\" height=\"' + (mapHeight+4) + '\"></iframe>');\r\n } else {\r\n var url = \"http://api.map.baidu.com/staticimage?center=\" + center.lng + ',' + center.lat +\r\n \"&zoom=\" + zoom + \"&width=\" + size.width + '&height=' + size.height + \"&markers=\" + point.lng + ',' + point.lat;\r\n editor.execCommand('inserthtml', '<img width=\"'+ size.width +'\"height=\"'+ size.height +'\" src=\"' + url + '\"' + (styleStr ? ' style=\"' + styleStr + '\"' :'') + '/>');\r\n }\r\n };\r\n document.getElementById(\"address\").focus();\r\n</script>\r\n\r\n\r\n</body>\r\n</html>\r\n";
});